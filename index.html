<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ù…Ù†Ø¸Ù… Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„</title>
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"/>
  <!-- SortableJS Ù„Ù„ØªØ±ØªÙŠØ¨ Ø¨Ø§Ù„Ø³Ø­Ø¨ -->
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <!-- SheetJS Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ Excel -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <!-- JsBarcode Ù„Ø±Ù…ÙˆØ² Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ -->
  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
  <!-- QRCode.js Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø±Ù…Ø² QR -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.4.4/build/qrcode.min.js"></script>
  <style>
    body { background: #f0f8ff; font-family: sans-serif; }
    .header { text-align: center; margin: 20px; position: relative; }
    .controls .form-control, .controls .btn { margin: 5px; }
    .order-grid { display: grid; gap: 20px; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); }
    .order-card { border-radius: .5rem; border: 1px solid #dee2e6; background: #fff; padding: 15px; position: relative; }
    .order-card.cod { border-color: #ffc107; background: #fff8e1; }
    .card-border { position: absolute; top: 0; right: 0; width: 5px; height: 100%; background: #5a35ff; border-bottom-right-radius: .5rem; border-top-right-radius: .5rem; }
    .order-number { position: absolute; top: 10px; left: 10px; background: #f8f9fa; color: #343a40; padding: 2px 8px; border-radius: .25rem; font-size: .9rem; }
    /* Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø¨ÙˆÙ„ÙŠØµØ© */
    .label { width: 300px; border: 1px solid #000; padding: 10px; margin: 5px; display: inline-block; font-size: 14px; direction: rtl; text-align: right; }
    .label-logo { display: block; margin: 0 auto 10px; max-width: 100px; }
    .label .header { display: flex; justify-content: space-between; margin-bottom: 10px; }
    .label .cod-box { font-weight: bold; }
    .label .amount-box { background: #000; color: #fff; padding: 5px; }
    .label .barcode, .label .qrcode { display: block; margin: 5px auto; }
  </style>
</head>

<body>

  <div class="header">
    <h1>Ù…Ù†Ø¸Ù… Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„</h1>
    <!-- Ù…Ø§Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ -->
    <input id="scanner" class="form-control scanner-input" placeholder="Ø§Ù…Ø³Ø­ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ Ù‡Ù†Ø§" autofocus/>
    <div class="controls row justify-content-center">
      <!-- Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù„Ù -->
      <div class="col-auto">
        <input type="file" id="fileInput" accept=".xlsx,.csv" class="form-control"/>
      </div>
      <!-- Ø¨Ø­Ø« -->
      <div class="col-auto">
        <input id="searchInput" class="form-control" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ Ø£Ùˆ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„"/>
      </div>
      <!-- ÙÙ„Ø§ØªØ± Ø§Ù„Ø­Ø§Ù„Ø© -->
      <div class="col-auto">
        <button class="btn btn-outline-secondary filter-btn" data-status="">Ø§Ù„ÙƒÙ„</button>
        <button class="btn btn-outline-info filter-btn" data-status="pending">Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</button>
        <button class="btn btn-outline-warning filter-btn" data-status="in_transit">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆØµÙŠÙ„</button>
        <button class="btn btn-outline-success filter-btn" data-status="delivered">ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„</button>
        <button class="btn btn-outline-primary filter-btn" data-status="cod">Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</button>
        <button class="btn btn-outline-danger filter-btn" data-status="rejected">Ù…Ø±ÙÙˆØ¶</button>
      </div>
      <!-- Ø£Ø²Ø±Ø§Ø± -->
      <div class="col-auto">
        <button id="enableManual" class="btn btn-info">ØªÙ…ÙƒÙŠÙ† Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„ÙŠØ¯ÙˆÙŠ</button>
        <button id="applyNumbers" class="btn btn-primary">ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ±Ù‚ÙŠÙ…</button>
        <button id="selectAll" class="btn btn-secondary">ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„</button>
        <button id="printSelected" class="btn btn-success"><i class="bi bi-printer"></i> Ø·Ø¨Ø§Ø¹Ø© Ø¨ÙˆÙ„ÙŠØµØ§Øª Ù…Ø®ØªØ§Ø±Ø©</button>
      </div>
    </div>
  </div>

  <!-- Ø´Ø¨ÙƒØ© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª -->
  <div id="orderGrid" class="container order-grid"></div>

  <!-- Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© -->
  <template id="orderCardTemplate">
    <div class="order-card">
      <div class="card-border"></div>
      <span class="order-number"></span>
      <h5 class="customer-name"></h5>
      <p class="customer-address"><i class="bi bi-geo-alt"></i> <span></span></p>
      <p><i class="bi bi-telephone"></i> <span class="phone"></span></p>
      <p><i class="bi bi-box-seam"></i> <span class="items-count"></span> Ù…Ù†ØªØ¬Ø§Øª</p>
      <p><i class="bi bi-clock"></i> <span class="time-range"></span></p>
      <div class="d-flex justify-content-between">
        <!-- Ø·Ø¨Ø§Ø¹Ø© Ø¨ÙˆÙ„ÙŠØµØ© ÙØ±Ø¯ÙŠØ© -->
        <button class="btn btn-outline-secondary btn-print-single"><i class="bi bi-printer"></i></button>
        <!-- ÙˆØ§ØªØ³Ø§Ø¨ Ø´Ø­Ù† -->
        <button class="btn btn-success btn-wa-shipping"><i class="bi bi-whatsapp"></i></button>
        <!-- ÙˆØ§ØªØ³Ø§Ø¨ ÙˆØµÙˆÙ„ -->
        <button class="btn btn-success btn-wa-arrival"><i class="bi bi-whatsapp"></i></button>
        <!-- Ø§ØªØµØ§Ù„ -->
        <button class="btn btn-primary btn-call"><i class="bi bi-telephone"></i></button>
      </div>
      <!-- Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… ÙŠÙ…ÙŠÙ‘Ø² Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© -->
      <span class="cod-marker badge bg-warning">Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</span>
      <!-- Ø§Ø®ØªÙŠØ§Ø± Ù„Ø·Ø¨Ø§Ø¹Ø© Ø¬Ù…Ø§Ø¹ÙŠØ© -->
      <input type="checkbox" class="form-check-input select-for-label" style="position:absolute;top:10px;left:10px;"/>
      <!-- Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ -->
      <select class="form-select status-select mt-2">
        <option value="pending">Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</option>
        <option value="in_transit">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆØµÙŠÙ„</option>
        <option value="delivered">ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„</option>
        <option value="cod">Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</option>
        <option value="rejected">Ù…Ø±ÙÙˆØ¶</option>
      </select>
    </div>
  </template>

  <!-- Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø¨ÙˆÙ„ÙŠØµØ© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© -->
  <template id="labelTemplate">
    <div class="label">
      <!-- Ø´Ø¹Ø§Ø± ÙˆØ§Ø­Ø© Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ø¶Ù…Ù† Base64 -->
      <img class="label-logo"
           src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAyAAAAEsCAYAAAA7Ldc6AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAFLWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSfvu78nIGlkPSdXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQnPz4KPHg6eG1wbWV0YSB4bWxuczp4PSdhZG9iZTpuczptZXRhLyc+CjxyZGY6UkRGIHhtbG5zOnJkZj0naHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyc+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpBdHRyaWI9J2h0dHA6Ly9ucy5hdHRyaWJ1dGlvbi5jb20vYWRzLzEuMC8nPgogIDxBdHRyaWI6QWRzPgogICA8cmRmOlNlcT4KICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0nUmVzb3VyY2UnPgogICAgIDxBdHRyaWI6Q3JlYXRlZD4yMDI1LTA2LTEyPC9BdHRyaWI6Q3JlYXRlZD4KICAgICA8QXR0cmliOkV4dElkPjI0MzMyMzIxLTcxMzktNDJjMi1iNjlmLTFiMjFhMjQyYzQ4YjwvQXR0cmliOkV4dElkPgogICAgIDxBdHRyaWI6RmJJZD41MjUyNjU5MTQxNzk1ODA8L0F0dHJpYjpGYklkPgogICAgIDxBdHRyaWI6VG91Y2hUeXBlPjI8L0F0dHJpYjpUb3VjaFR5cGU+CiAgICA8L3JkZjpsaT4KICAgPC9yZGY6U2VxPgogIDwvQXR0cmliOkFkcz4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PScnCiAgeG1sbnM6ZGM9J2h0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvJz4KICA8ZGM6dGl0bGU+CiAgIDxyZGY6QWx0PgogICAgPHJkZjpsaSB4bWw6bGFuZz0neC1kZWZhdWx0Jz7ZiNin2K3YqSDYp9mE2KrZgtmG2YrYqSAoMTAwMCB4IDUwMCDYqNmK2YPYs9mEKSAoMTAwMCB4IDUwMCDYqNmK2YPYs9mEKSAoODAwIHggMzUwINio2YrZg9iz2YQpICg4MDAgeCAzMDAg2KjZitmD2LPZhCkgLSAxPC9yZGY6bGk+CiAgIDwvcmRmOkFsdD4KICA8L2RjOnRpdGxlPgogPC9yZGY6RGVzY3JpcHRpb24+CgogPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczpwZGY9J2h0dHA6Ly9ucy5hZG9iZS5jb20vcGRmLzEuMy8nPgogIDxwZGY6QXV0aG9yPtin2KjYsdin2YfZitmFINi52YrYrzwvcGRmOkF1dGhvcj4KIDwvcmRmOkRlc2NyaXB0aW9uPgoKPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9JycKICB4bWxuczp4bXBjb25...
      " alt="Ø´Ø¹Ø§Ø± ÙˆØ§Ø­Ø© Ø§Ù„ØªÙ‚Ù†ÙŠØ©">
      <div class="header">
        <div class="cod-box">Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</div>
        <div class="amount-box">0</div>
      </div>
      <h1 class="order-number">#123456</h1>
      <p class="customer-name">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</p>
      <p class="customer-address">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„</p>
      <!-- Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ -->
      <svg class="barcode"
           jsbarcode-format="CODE128"
           jsbarcode-value="123456"
           jsbarcode-textmargin="0"
           jsbarcode-fontSize="12"
           jsbarcode-height="40"
           jsbarcode-width="2"></svg>
      <!-- Ø§Ù„Ù€ QR -->
      <canvas class="qrcode"></canvas>
    </div>
  </template>

  <!-- Ø§Ù„ØµÙˆØª -->
  <audio id="audioSuccess" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>
  <audio id="audioError"   src="https://actions.google.com/sounds/v1/cartoon/boing.ogg"></audio>

  <!-- Bootstrap & JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Ø§Ù„Ø¹Ù†Ø§ØµØ±
    const fileInput      = document.getElementById('fileInput');
    const orderGrid      = document.getElementById('orderGrid');
    const cardTpl        = document.getElementById('orderCardTemplate');
    const labelTpl       = document.getElementById('labelTemplate');
    const searchInput    = document.getElementById('searchInput');
    const filterBtns     = document.querySelectorAll('.filter-btn');
    const scannerInput   = document.getElementById('scanner');
    const audioSuccess   = document.getElementById('audioSuccess');
    const audioError     = document.getElementById('audioError');
    const enableManual   = document.getElementById('enableManual');
    const applyNumbers   = document.getElementById('applyNumbers');
    const selectAllBtn   = document.getElementById('selectAll');
    const printSelBtn    = document.getElementById('printSelected');

    let orders = [], dragger;

    // Ø§Ø³ØªÙŠØ±Ø§Ø¯ Excel/CSV
    fileInput.addEventListener('change', e=>{
      if(!e.target.files.length) return;
      const f = e.target.files[0];
      const reader = new FileReader();
      reader.onload = evt=>{
        const data = evt.target.result;
        const wb = XLSX.read(data, {type:'binary'});
        const sheet = wb.Sheets[wb.SheetNames[0]];
        const js = XLSX.utils.sheet_to_json(sheet);
        orders = js.map((r,i)=>({
          idx:i+1,
          orderId:r['Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨']||r['Order ID']||'',
          customerName:r['Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„']||r['Customer']||'',
          address:r['Ø§Ù„Ø¹Ù†ÙˆØ§Ù†']||r['Address']||'',
          phone:r['Ø§Ù„Ù‡Ø§ØªÙ']||r['Phone']||'',
          itemsCount:r['Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª']||r['Items']||0,
          timeRange:r['Ø§Ù„ÙˆÙ‚Øª']||r['Time']||'',
          status:'pending',
          codPayment:(r['Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹']||'').includes('Ø§Ø³ØªÙ„Ø§Ù…')
        }));
        render();
        enableDrag();
      };
      reader.readAsBinaryString(f);
    });

    // Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
    function render(){
      orderGrid.innerHTML='';
      orders.forEach(o=>{
        const tpl = cardTpl.content.cloneNode(true);
        const card = tpl.querySelector('.order-card');
        tpl.querySelector('.order-number').textContent = o.idx;
        tpl.querySelector('.customer-name').textContent = o.customerName;
        tpl.querySelector('.customer-address span').textContent = o.address;
        tpl.querySelector('.phone').textContent = o.phone;
        tpl.querySelector('.items-count').textContent = o.itemsCount;
        tpl.querySelector('.time-range').textContent = o.timeRange;
        // CODØŸ
        if(o.codPayment) card.classList.add('cod');
        // Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ â€“ Ø´Ø­Ù†
        tpl.querySelector('.btn-wa-shipping').onclick = ()=>{
          const msg = `Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…\nØ£Ù†Ø§ Ù…Ù†Ø¯ÙˆØ¨ ÙˆØ§Ø­Ø© Ø§Ù„ØªÙ‚Ù†ÙŠØ©\nÙ„Ø¯ÙŠÙƒ Ø·Ù„Ø¨ÙŠØ© Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„ØªÙˆØµÙŠÙ„\nØ£Ø±Ø³Ù„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ğŸ“\nÙˆØ±Ù‚Ù… Ø§Ù„Ù…Ù†Ø²Ù„ğŸš\nÙˆØ³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø¨Ù„ Ø§Ù„ØªÙˆØµÙŠÙ„â³ğŸš—`;
          window.open(`https://wa.me/${o.phone}?text=${encodeURIComponent(msg)}`, '_blank');
        };
        // Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ â€“ ÙˆØµÙˆÙ„
        tpl.querySelector('.btn-wa-arrival').onclick = ()=>{
          const msg = `Ø¯Ù‚ÙŠÙ‚Ø© ØªÙ‚Ø±ÙŠØ¨Ø§ ÙˆØ¨ÙƒÙˆÙ† ÙÙŠ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù† Ø´Ø§Ø¡Ø§Ù„Ù„Ù‡\nÙ…Ù†Ø§Ø³Ø¨ØŸØŸ`;
          window.open(`https://wa.me/${o.phone}?text=${encodeURIComponent(msg)}`, '_blank');
        };
        // Ø§ØªØµØ§Ù„
        tpl.querySelector('.btn-call').onclick = ()=> location.href = `tel:${o.phone}`;
        // ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø©
        tpl.querySelector('.status-select').value = o.status;
        tpl.querySelector('.status-select').onchange = e=>{
          o.status = e.target.value;
          card.gridRowStart = ''; // Ù„ÙØ±Ø² Ù…Ø¬Ø¯Ø¯Ø§Ù‹
        };
        // Ø·Ø¨Ø§Ø¹Ø© ÙØ±Ø¯ÙŠØ©
        tpl.querySelector('.btn-print-single').onclick = ()=>{
          printLabels([o]);
        };
        // Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ
        tpl.querySelector('.select-for-label').onchange = ()=>{};
        orderGrid.append(tpl);
      });
    }

    // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¥ÙÙ„Ø§Øª
    function enableDrag(){
      if(dragger) dragger.destroy();
      dragger = Sortable.create(orderGrid, {
        handle: '.order-card',
        animation: 150,
        onEnd: e=>{
          const moved = orders.splice(e.oldIndex,1)[0];
          orders.splice(e.newIndex,0,moved);
          orders.forEach((o,i)=>o.idx=i+1);
          render();
        }
      });
    }

    // ØªØ±Ù‚ÙŠÙ… ÙŠØ¯ÙˆÙŠ
    applyNumbers.onclick = ()=>{
      document.querySelectorAll('.order-card').forEach((card,i)=>{
        const num = card.querySelector('input[type=number]')?.value || i+1;
        orders[i].idx = +num;
      });
      orders.sort((a,b)=>a.idx-b.idx);
      render();
    };

    // Ø¨Ø­Ø«
    searchInput.oninput = ()=>{
      const q = searchInput.value.trim();
      document.querySelectorAll('.order-card').forEach((card,i)=>{
        const o = orders[i];
        const match = !q || o.orderId.includes(q) || o.customerName.includes(q);
        card.style.display = match? '' : 'none';
      });
    };

    // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©
    filterBtns.forEach(btn=>{
      btn.onclick = ()=>{
        filterBtns.forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        const st = btn.dataset.status;
        document.querySelectorAll('.order-card').forEach((card,i)=>{
          const o = orders[i];
          card.style.display = (st===''||o.status===st)? '' : 'none';
        });
      };
    });

    // Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
    scannerInput.onkeypress = e=>{
      if(e.key!=='Enter') return;
      const code = scannerInput.value.trim();
      const idx = orders.findIndex(o=>o.orderId===code);
      if(idx>=0){
        orders[idx].status = 'in_transit';
        audioSuccess.play();
        render();
      } else {
        audioError.play();
      }
      scannerInput.value='';
    };

    // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„
    selectAllBtn.onclick = ()=>{
      const boxes = document.querySelectorAll('.select-for-label');
      const all = [...boxes].every(b=>b.checked);
      boxes.forEach(b=>b.checked=!all);
    };

    // Ø·Ø¨Ø§Ø¹Ø© Ø¨ÙˆÙ„ÙŠØµØ§Øª Ù…Ø®ØªØ§Ø±Ø©
    printSelBtn.onclick = ()=>{
      const selected = [...document.querySelectorAll('.select-for-label')]
        .map((b,i)=>b.checked? orders[i]: null)
        .filter(x=>x);
      if(selected.length) printLabels(selected);
    };

    // Ø·Ø¨Ø§Ø¹Ø© Ø¨ÙˆÙ„ÙŠØµØ§Øª
    function printLabels(list){
      const w = window.open('', '_blank');
      w.document.write('<!DOCTYPE html><html lang="ar" dir="rtl"><head><meta charset="utf-8"/><title>Ø¨ÙˆÙ„ÙŠØµØ§Øª Ø´Ø­Ù†</title>');
      w.document.write('<style>body{font-family:sans-serif;direction:rtl} .label{display:inline-block;margin:5px;} </style></head><body>');
      list.forEach(o=>{
        const tpl = labelTpl.content.cloneNode(true);
        tpl.querySelector('.order-number').textContent = '#'+o.orderId;
        tpl.querySelector('.customer-name').textContent = o.customerName;
        tpl.querySelector('.customer-address').textContent = o.address;
        tpl.querySelector('.amount-box').textContent = o.codPayment? o.itemsCount : 0;
        // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
        const svg = tpl.querySelector('.barcode');
        svg.setAttribute('jsbarcode-value', o.orderId);
        JsBarcode(svg).init();
        // ØªÙˆÙ„ÙŠØ¯ QR
        const canvas = tpl.querySelector('.qrcode');
        QRCode.toCanvas(canvas, o.orderId, { width: 80 });
        w.document.body.appendChild(tpl);
      });
      w.document.close();
      w.print();
    }
  </script>
</body>
</html>
