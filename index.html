<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>منظم طلبات التوصيل</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet"/>
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
  <style>
    body { background: #f0f8ff; font-family: 'Tajawal', sans-serif; }
    .order-card .select-label, .order-list-row .select-label {
      position: absolute; top: 10px; right: 10px; z-index: 10;
    }
    @media print {
      body { background: #fff !important; }
      .label {
        page-break-inside: avoid;
        page-break-after: always;
        break-inside: avoid;
      }
      .container, .header, .controls, .status-filters {
        display: none !important;
      }
      #ordersContainer {
        margin: 0 !important;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1 class="text-primary">منظم طلبات التوصيل</h1>
      <input id="scannerInput" class="form-control scanner-input" placeholder="امسح رقم الطلب هنا" autofocus>
    </div>
    <div id="ordersContainer" class="order-grid mb-4"></div>
  </div>

  <!-- أصوات التنبيه -->
  <audio id="successSound" src="success.mp3"></audio>
  <audio id="errorSound" src="error.mp3"></audio>

  <script>
    let orders = [
      {"رقم الطلب": "123", "اسم العميل": "محمد", "status": "قيد الانتظار"},
      {"رقم الطلب": "456", "اسم العميل": "سارة", "status": "جاري التوصيل"}
    ];

    function save() { localStorage.setItem('ordersData', JSON.stringify(orders)); }
    function render() {
      const cont = document.getElementById('ordersContainer');
      cont.innerHTML = '';
      orders.forEach(o => {
        const card = document.createElement('div');
        card.className = 'order-card card p-3 position-relative';
        card.setAttribute('data-id', o['رقم الطلب']);
        card.innerHTML = `
          <input type="checkbox" class="form-check-input select-label"/>
          <h5>#${o['رقم الطلب']}</h5>
          <p>${o['اسم العميل']} - الحالة: ${o.status}</p>`;
        cont.appendChild(card);
      });
    }

    document.getElementById('scannerInput').addEventListener('keydown', function(e){
      if(e.key === "Enter"){
        const val = this.value.trim();
        const idx = orders.findIndex(x => (x['رقم الطلب'] || '').toString() === val);
        const successSound = document.getElementById('successSound');
        const errorSound = document.getElementById('errorSound');

        if(idx !== -1){
          const order = orders[idx];
          if(order.status === 'قيد الانتظار'){
            order.status = 'جاري التوصيل';
            save();
            render();
            successSound.play();
          } else {
            errorSound.play();
          }
          document.querySelectorAll('.order-card')[idx]?.scrollIntoView({behavior:'smooth'});
        } else {
          errorSound.play();
        }
        this.value = '';
      }
    });

    window.onload = render;
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
